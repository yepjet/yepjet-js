{"version":3,"sources":["ApiResource.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQb,IAAM,YAAY,GAAG,IAAI,OAAO,EAAE,CAAC;;IAE7B,WAAW;AACf,WADI,WAAW,CACH,IAAI,EAAE,IAAI,EAAE;0BADpB,WAAW;;AAEb,gBAAY,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;AACvC,QAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;eAJG,WAAW;;4BAWP,IAAI,EAAE;AACZ,UAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC;AACnC,UAAI,CAAC,IAAI,GAAK,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC;AAC9B,UAAI,cAAc,GAAG,eAAK,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;AACrD,UAAI,GAAG,GAAG,uBAAI,OAAO,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC;AACzD,UAAI,cAAc,GAAG;AACnB,cAAM,EAAE,IAAI,CAAC,MAAM;AACnB,eAAO,EAAE,IAAI,CAAC,OAAO;AACrB,WAAG,EAAE,GAAG;OACT,CAAC;;AAEF,UAAI,QAAQ,GAAG,YAAE,KAAK,EAAE,CAAC;;AAEzB,cAAO,IAAI,CAAC,MAAM;AAChB,aAAK,MAAM,CAAC;AACZ,aAAK,KAAK;AACR,wBAAc,CAAC,IAAI,GAAG,IAAI,CAAC;AAC3B,wBAAc,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;AAChC,gBAAM;AAAA,AACR,aAAK,KAAK;AACR,cAAI,IAAI,CAAC,IAAI,EAAE,cAAc,CAAC,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;AAC7C,gBAAM;AAAA,OACT;;AAED,6BAAQ,cAAc,EAAE,UAAS,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE;AACpD,YAAI,GAAG,EAAE;AACP,kBAAQ,CAAC,MAAM,CAAC,YAzChB,YAAY,CAyCqB,GAAG,CAAC,CAAC,CAAC;SACxC,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;AAC/C,kBAAQ,CAAC,MAAM,CAAC,YA3CF,SAAS,CA2CO,QAAQ,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC;SAC3D,MAAM;AACL,kBAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SACxB;OACF,CAAC,CAAC;;AAEH,aAAO,QAAQ,CAAC,OAAO,CAAC;KACzB;;;wBAxCa;AACZ,UAAM,IAAI,GAAG,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;AACzC,aAAO,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;KACjC;;;SATG,WAAW;;;kBAiDF,WAAW","file":"resources/ApiResource.js","sourcesContent":["'use strict';\n\nimport path     from 'path';\nimport ptr      from 'path-to-regexp';\nimport Q        from 'q';\nimport request  from 'request';\nimport {NetworkError, HTTPError} from './errors';\n\nconst privateProps = new WeakMap();\n\nclass APIResource {\n  constructor(conf, name) {\n    privateProps.set(this, { conf: conf });\n    this.name = name;\n  }\n\n  get baseUrl() {\n    const conf = privateProps.get(this).conf;\n    return conf.host + conf.version;\n  }\n\n  request(args) {\n    args.method = args.method || 'GET';\n    args.path   = args.path || '';\n    let uncompiledPath = path.join(this.name, args.path);\n    let uri = ptr.compile(uncompiledPath)(args.params || {});\n    let requestOptions = {\n      method: args.method,\n      baseUrl: this.baseUrl, \n      uri: uri\n    };\n\n    let deferred = Q.defer();\n\n    switch(args.method) {\n      case 'POST':\n      case 'PUT':\n        requestOptions.json = true;\n        requestOptions.body = args.data;\n        break;\n      case 'GET':\n        if (args.data) requestOptions.qs = args.data;\n        break;\n    }\n\n    request(requestOptions, function(err, response, body) {\n      if (err) {\n        deferred.reject(new NetworkError(err));\n      } else if (!/^2\\d\\d$/.test(response.statusCode)) {\n        deferred.reject(new HTTPError(response.statusCode, body));\n      } else {\n        deferred.resolve(body);\n      }\n    });\n\n    return deferred.promise;\n  }\n}\n\nexport default APIResource;\n"],"sourceRoot":"/source/"}