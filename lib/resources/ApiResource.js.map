{"version":3,"sources":["resources/ApiResource.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASb,IAAM,YAAY,GAAG,IAAI,OAAO,EAAE,CAAC;;IAE7B,WAAW;AACf,WADI,WAAW,CACH,IAAI,EAAE,IAAI,EAAE;0BADpB,WAAW;;AAEb,gBAAY,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;AACvC,QAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;eAJG,WAAW;;8BAeI;UAAX,IAAI,yDAAG,EAAE;;AACf,UAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC;AACnC,UAAI,CAAC,IAAI,GAAK,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC;AAC9B,UAAI,cAAc,GAAG,eAAK,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;AACrD,UAAI,GAAG,YAAA,CAAC;;AAER,UAAI;AACF,WAAG,GAAG,uBAAI,OAAO,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;OAChD,CAAC,OAAM,CAAC,EAAE;AACT,cAAM,YA5BJ,gBAAgB,CA4BS,CAAC,CAAC,OAAO,CAAC,CAAC;OACvC;;AAED,UAAI,cAAc,GAAG;AACnB,cAAM,EAAE,IAAI,CAAC,MAAM;AACnB,eAAO,EAAE,IAAI,CAAC,OAAO;;AAErB,eAAO,EAAE;AACP,wBAAc,EAAE,kBAAkB;SACnC;AACD,WAAG,EAAE,GAAG;OACT,CAAC;;AAEF,cAAO,IAAI,CAAC,MAAM;AAChB,aAAK,MAAM,CAAC;AACZ,aAAK,KAAK;AACR,wBAAc,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,CAAC;AACtD,gBAAM;AAAA,AACR,aAAK,KAAK;AACR,wBAAc,CAAC,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;AAAA,OACjC;;AAED,UAAI,QAAQ,GAAG,YAAE,KAAK,EAAE,CAAC;;AAEzB,6BAAQ,cAAc,EAAE,UAAS,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE;AACpD,YAAI;AACF,cAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;SACzB,CAAC,OAAM,CAAC,EAAE,EAAE;;AAEb,YAAI,GAAG,EAAE;AACP,kBAAQ,CAAC,MAAM,CAAC,YA1DE,YAAY,CA0DG,GAAG,CAAC,CAAC,CAAC;SACxC,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;AAC/C,kBAAQ,CAAC,MAAM,CAAC,YA5DgB,SAAS,CA4DX,QAAQ,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC;SAC3D,MAAM;AACL,kBAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SACxB;OACF,CAAC,CAAC;;AAEH,aAAO,QAAQ,CAAC,OAAO,CAAC;KACzB;;;wBAzDa;AACZ,UAAM,IAAI,GAAG,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;AACzC,aAAO,cAAI,MAAM,CAAC;AAChB,gBAAQ,EAAE,MAAM;AAChB,YAAI,EAAE,IAAI,CAAC,IAAI;AACf,gBAAQ,EAAE,IAAI,CAAC,OAAO;OACvB,CAAC,CAAC;KACJ;;;SAbG,WAAW;;;kBAkEF,WAAW","file":"resources/ApiResource.js","sourcesContent":["'use strict';\n\nimport path     from 'path';\nimport url      from 'url';\nimport ptr      from 'path-to-regexp';\nimport Q        from 'q';\nimport request  from 'request';\nimport {WrongParamsError, NetworkError, HTTPError} from './errors';\n\nconst privateProps = new WeakMap();\n\nclass ApiResource {\n  constructor(conf, name) {\n    privateProps.set(this, { conf: conf });\n    this.name = name;\n  }\n\n  get baseUrl() {\n    const conf = privateProps.get(this).conf;\n    return url.format({\n      protocol: 'http',\n      host: conf.host,\n      pathname: conf.version\n    });\n  }\n\n  request(args = {}) {\n    args.method = args.method || 'GET';\n    args.path   = args.path || '';\n    let uncompiledPath = path.join(this.name, args.path);\n    let uri;\n\n    try {\n      uri = ptr.compile(uncompiledPath)(args.params);\n    } catch(e) {\n      throw new WrongParamsError(e.message);\n    }\n\n    let requestOptions = {\n      method: args.method,\n      baseUrl: this.baseUrl, \n\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      uri: uri\n    };\n\n    switch(args.method) {\n      case 'POST':\n      case 'PUT':\n        requestOptions.body = JSON.stringify(args.data || {});\n        break;\n      case 'GET':\n        requestOptions.qs = args.data;\n    }\n\n    let deferred = Q.defer();\n\n    request(requestOptions, function(err, response, body) {\n      try {\n        body = JSON.parse(body);\n      } catch(e) {}\n\n      if (err) {\n        deferred.reject(new NetworkError(err));\n      } else if (!/^2\\d\\d$/.test(response.statusCode)) {\n        deferred.reject(new HTTPError(response.statusCode, body));\n      } else {\n        deferred.resolve(body);\n      }\n    });\n\n    return deferred.promise;\n  }\n}\n\nexport default ApiResource;\n"],"sourceRoot":"/source/"}